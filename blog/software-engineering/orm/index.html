<!DOCTYPE html>
<html lang="en">
<head>
  <title>Object Relational Mapping – Lucas David</title>
  <meta charset="utf-8" />
<meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
<meta http-equiv='X-UA-Compatible' content='IE=edge'>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="image_src" type="image/png" href="img_path" />


<meta name="description" content="An Overview on How ORMs Work in Multiple Languages" />
<meta property="og:description" content="An Overview on How ORMs Work in Multiple Languages" />
<meta property="og:image" content="" />

<meta name="author" content="Lucas David" />


<meta property="og:title" content="Object Relational Mapping" />
<meta property="twitter:title" content="Object Relational Mapping" />


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<link rel="alternate" type="application/rss+xml" title="Lucas David - my personal website/blog"
      href="/feed.xml" />

  
  
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-LG7FZ8VCHM"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-LG7FZ8VCHM');
	</script>


  
  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="/style.css" />

</head>
<body>
  <nav id="mainNav" class="navbar navbar-light bg-white navbar-expand-lg d-print-none border-bottom border-light ">
  <div class="container-xl">
    <button class="navbar-toggler rounded-0 border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01"
      aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <a class="navbar-brand fw-bold text-decoration-none p-1" href="/">Lucas David</a>

    <div class="collapse navbar-collapse" id="navbarTogglerDemo01">

      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      </ul>
      <span class="navbar-text navbar-excerpt">
        Object Relational Mapping
      </span>
      <span class="navbar-text font-small ms-2 me-2 sr-none" aria-hidden="true">•</span>
      <ul class="navbar-nav mb-2 mb-lg-0 font-small">
        <li class="nav-item"><a href="/" class="nav-link fw-bold link-dark fs-6">Home</a></li>
        <li class="nav-item"><a href="/blog" class="nav-link fw-bold link-dark fs-6">Blog</a></li>
        <li class="nav-item"><a href="/publications" class="nav-link fw-bold link-dark fs-6">Publications</a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle fw-bold link-dark fs-6" href="#" id="nbd-links-social" role="button"
            data-bs-toggle="dropdown" aria-expanded="false">
            Social
          </a>
          <ul class="dropdown-menu font-small dropdown-menu-end" aria-labelledby="nbd-links-social">
            <li><a class="dropdown-item text-decoration-none" target="_blank"
                href="https://github.com/lucasdavid">
                <i aria-label="GitHub" class="bi bi-github link-dark sr-none"></i>
                Github</a></li>
            <li><a class="dropdown-item text-decoration-none" target="_blank"
                href="https://www.linkedin.com/in/ld7">
                <i class="bi bi-linkedin text-primary sr-none"></i>
                Linkedin</a></li>

            <li itemscope itemtype="https://schema.org/Person">
              <a itemprop="sameAs" content="https://orcid.org/0000-0002-8793-7300" href="https://orcid.org/0000-0002-8793-7300"
                  target="orcid.widget"
                  rel="me noopener noreferrer"
                  class="dropdown-item text-decoration-none"
                >
                <img src="/assets/images/infra/32px-ORCID_iD.webp" alt="ORCID logo" class="sr-none" style="margin-bottom: 5px; width: 16px;">
                ORCID</a>
            </li>

            <li><a class="dropdown-item text-decoration-none" target="_blank"
                href="http://stackoverflow.com/users/2429640/lucasdavid">
                <i class="bi bi-code-slash link-dark sr-none"></i>
                Stackoverflow</a></li>
            <li><a class="dropdown-item text-decoration-none" target="_blank"
                href="https://youtube.com/channel/UC7IWeKUy4OSlC5ripcQGD6Q">
                <i class="bi bi-youtube text-danger sr-none"></i>
                Youtube</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <div class="empty-v-space d-none d-xl-block" style="margin-bottom: 5vh"></div>
</div>
<div class="container-fluid mt-4">
  <div class="row">
    <div class="col-12 col-xl-3 col-xxl-2 offset-xxl-1">
      <div id="sidebar" class="">
  <div class="text-center">
    <a href="/" title="Home">
      <img src="/assets/images/infra/aloy-100.png" alt="Aloy, a character from Horizon Zero Dawn."
        class="img-fluid rounded-circle" style="width:100px" />
    </a>
    <p class="pt-2 font-small">
      
        <a href="mailto:mb37410l3@mozmail.com" class="text-decoration-none fw-bold">mb37410l3@mozmail.com</a>
      
    </p>
  </div>

  
</div>

    </div>
    <div id="table-of-contents-container-r" class="col-12 col-xl-3 col-xxl-2 order-xl-2">
      
      <div style="z-index: 0; font-size:0.8rem;">
        <div id="table-of-contents" class="font-small">
  <p class="border-bottom"><strong>Summary</strong></p>
  <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#what-is-our-problem">What is our problem?</a></li>
<li class="toc-entry toc-h2"><a href="#how-do-we-solve-it">How do we solve it?</a></li>
<li class="toc-entry toc-h2"><a href="#a-few-cases-to-ponder">A few cases to ponder</a>
<ul>
<li class="toc-entry toc-h3"><a href="#1-user-registration">#1 User registration</a></li>
<li class="toc-entry toc-h3"><a href="#2-ordering-schedules">#2 Ordering Schedules</a></li>
<li class="toc-entry toc-h3"><a href="#3-joining">#3 Joining</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#existing-orms">Existing ORMs</a></li>
<li class="toc-entry toc-h2"><a href="#cool-additional-features">Cool additional features</a>
<ul>
<li class="toc-entry toc-h3"><a href="#lazy-and-eager-loading">Lazy and eager loading</a></li>
<li class="toc-entry toc-h3"><a href="#automatic-migrations">Automatic migrations</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#short-version-for-lazy-loaders">Short version for lazy-loaders</a></li>
</ul>
</div>

      </div>
      
    </div>
    <div class="col-12 col-xl-6">
      <article class="post mb-4">
        <header class="">
          <h1 id="postTitle" class="fw-bold">Object Relational Mapping</h1>
          <p class="right-align mb-2 text-muted fs-5">
            An Overview on How ORMs Work in Multiple Languages <em>— October  2, 2017</em>
          </p>
          <div class="mb-4">
            <span class="badges-container">
  
    <a href="/blog/tag/patterns"
       class="btn badge rounded-pill btn-dark text-bg-dark text-decoration-none"
       style="font-size: 0.8em;"
       type="button"
       role="button"
       >Patterns</a>
  
</span>

          </div>
        </header>
        <div class="article-content" style="margin-top: 4rem;">
          <p><span>The</span> understanding over Object Relational Mapping, or <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a>, is fundamental to any good programmer. There are extremely few situations where its usage isn’t recommended, if any at all. If you need some incentive to learn it:</p>

<blockquote>
  <p><strong>#1</strong> Testing/debugging sucks ass.</p>
</blockquote>

<p>It’s a fact. Maintenance involves costly activities. It would be nice if we could reduce these to a minimum level of resource and stress, allowing us to concentrate on more fun parts of our job, such as architecture! To achieve that, the computing community has developed a wide range of techniques. <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a> is one of them and might help you to produce better code. Or not. But that’s up for each one of us to decide. In my opinion, it’s awesome.</p>

<figure>
  <img src="/assets/images/posts/orm.webp" alt="An overview sketch of an ORM" class="figure-img img-fluid rounded" />
    <figcaption>An overview sketch of an ORM. Available at:
      <a href="https://blog.yellowant.com/orm-rethinking-data-as-objects-8ddaa43b1410">blog.yellowant.com</a></figcaption>
</figure>

<h2 id="what-is-our-problem">What is our problem?</h2>
<p>How one interacts with their data can create a huge complexity in their code. Large <a href="http://en.wikipedia.org/wiki/Join_%28SQL%29">joins</a> and <a href="http://dba.stackexchange.com/questions/12619/what-does-the-term-projection-refer-to-in-an-sql-query-or-view-definition">projections</a> can be awfully complicated. We want to reduce this complexity.</p>

<h2 id="how-do-we-solve-it">How do we solve it?</h2>
<p>Let’s try to get rid of the <code class="language-plaintext highlighter-rouge">SQL</code> queries and replace them by native code that will sound more natural, considering its context. This code will be translated into <code class="language-plaintext highlighter-rouge">SQL</code> code eventually, giving us the exact same response with similar performance (it can be better, when caching is involved). In another words, let’s <em>abstract the data layer</em>.</p>

<h2 id="a-few-cases-to-ponder">A few cases to ponder</h2>
<h3 id="1-user-registration">#1 User registration</h3>
<p>A user has just registered, which means we should persist his account data. All the data is in an instance of the class <code class="language-plaintext highlighter-rouge">User</code>:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init___</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
</code></pre></div></div>

<p>Using SQL, I’d probably execute the <code class="language-plaintext highlighter-rouge">SQL INSERT</code> command in order to add that entry in the database.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">c</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"INSERT INTO Users VALUES ("</span><span class="o">+</span> <span class="n">user</span><span class="p">.</span><span class="n">email</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">user</span><span class="p">.</span><span class="n">password</span> <span class="o">+</span> <span class="s">")"</span><span class="p">)</span>
<span class="n">conn</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Now imagine that User class has 30 properties. That <code class="language-plaintext highlighter-rouge">c.execute()</code> line would be huge! A bunch of lines will hold exclusively a giant string that isn’t even in our “native language” (<code class="language-plaintext highlighter-rouge">Python</code>, in this case). Wouldn’t it be nice if we could simply instantiate the class <code class="language-plaintext highlighter-rouge">User</code>, fill <code class="language-plaintext highlighter-rouge">email</code> and <code class="language-plaintext highlighter-rouge">password</code> and call a method <code class="language-plaintext highlighter-rouge">.save()</code> that would persist the data somehow? Something like:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="s">'ldavid@ufscar.br'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'godragons'</span><span class="p">,</span> <span class="p">...)</span>
<span class="n">user</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></div>

<p>So much more intuitive!</p>

<h3 id="2-ordering-schedules">#2 Ordering Schedules</h3>
<p>Consider the class <code class="language-plaintext highlighter-rouge">Schedules</code> that holds a reference to a specific time-window in the week. Additionally, <code class="language-plaintext highlighter-rouge">Schedules</code> has a relationship <code class="language-plaintext highlighter-rouge">many-to-many</code> with <code class="language-plaintext highlighter-rouge">Class</code> (academic <code class="language-plaintext highlighter-rouge">classes</code>, that is, where those <code class="language-plaintext highlighter-rouge">Classes</code> can have many different <code class="language-plaintext highlighter-rouge">Schedules</code>):</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Schedule</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">TimeSpan</span> <span class="n">TimeStarted</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">TimeSpan</span> <span class="n">TimeFinished</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">DayOfWeek</span> <span class="n">DayOfWeek</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">Class</span><span class="p">&gt;</span> <span class="n">Classes</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Class</span>
<span class="p">{</span>
    <span class="p">...</span> <span class="c1">// Class properties, such as professor, course, students etc</span>

    <span class="k">public</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">Schedule</span><span class="p">&gt;</span> <span class="n">Schedules</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now, I have a weekly calendar and I’d like to put all these schedules onto the calendar. However, it wouldn’t make sense to display a schedule of <strong>Tuesday night</strong> followed by a <strong>Monday morning</strong>. I want to <strong>order</strong> the entries in the database first. So, using good old <code class="language-plaintext highlighter-rouge">SQL</code>, it would probably look something like:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="s">"..."</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">command</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SqlCommand</span><span class="p">(</span><span class="s">"select * from Schedules order by DayOfWeek, TimeStarted"</span><span class="p">,</span> <span class="n">connection</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="n">DbConnection</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>

<span class="c1">// a foreach loop to extract schedules from response.</span>
</code></pre></div></div>

<p>Okay, not so bad. At least it’s not so long. But there are some problems: we are leaving <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">Object oriented programming</a> and writing a command, strongly coupling the code with the manner in which the data is stored (it’s clearly a <a href="http://en.wikipedia.org/wiki/Relational_database">relational database</a>). Another point is that we had to use three more classes in order to do a simple ordering in the database. What if we could simply run a chained statement, order and retrieve the data from the database, and already obtain the objects?</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">schedules</span> <span class="p">=</span> <span class="n">Db</span><span class="p">.</span><span class="n">Schedules</span>
    <span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">DayOfWeek</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">ThenBy</span><span class="p">(</span><span class="n">TimeStarted</span><span class="p">);</span>
</code></pre></div></div>
<p>Pretty neat, right?</p>

<h3 id="3-joining">#3 Joining</h3>
<p>Still looking at the <code class="language-plaintext highlighter-rouge">Schedules</code> domain, what if we wanted to select all <code class="language-plaintext highlighter-rouge">Classes</code> that start after 8am on a Monday?</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">eight</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TimeSpan</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="s">"..."</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">command</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SqlCommand</span><span class="p">(</span>
    <span class="s">"select Classes.* from Schedules, Classes, ClassesSchedules"</span> <span class="p">+</span>
    <span class="s">"where"</span> <span class="p">+</span>
    <span class="s">"    Schedules.DayOfWeek = DayOfWeek.Monday and Schedules.TimeStarted &gt;= "</span> <span class="p">+</span> <span class="n">eight</span><span class="p">.</span><span class="n">Ticks</span> <span class="s">" +
</span>    <span class="s">"    and ClassesSchedules.ScheduleId = Schedules.Id"</span> <span class="p">+</span>
    <span class="s">"    and ClassesSchedules.ClassesId = Classes.Id"</span>
    <span class="p">,</span> <span class="n">connection</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="n">DbConnection</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
</code></pre></div></div>

<p>Well, it’s kind of obvious the point that I’m trying to make:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">classes</span> <span class="p">=</span> <span class="n">Db</span><span class="p">.</span><span class="n">Classes</span>
    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Schedules</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span>
        <span class="n">s</span><span class="p">.</span><span class="n">DayOfWeek</span> <span class="p">==</span> <span class="n">DayOfWeek</span><span class="p">.</span><span class="n">Monday</span>
        <span class="p">&amp;&amp;</span> <span class="n">s</span><span class="p">.</span><span class="n">TimeStarted</span> <span class="p">&gt;=</span> <span class="k">new</span> <span class="nf">TimeSpan</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)));</span>
</code></pre></div></div>

<blockquote>
  <p><strong>#2</strong> This is how you read it: give me all the <code class="language-plaintext highlighter-rouge">Classes</code> where those classes have at least on <code class="language-plaintext highlighter-rouge">Schedule</code> that is on a Monday and has its <code class="language-plaintext highlighter-rouge">TimeStarted</code> greater or equal than 8am.</p>
</blockquote>

<blockquote>
  <p><strong>#3</strong> Even if the above looks alien to you, you have to admit that is much easier than writing a <code class="language-plaintext highlighter-rouge">join</code>, right? This is called <a href="https://msdn.microsoft.com/en-us/library/bb397926.aspx">LINQ</a>, and is one of the reasons why I love C#! :-)</p>
</blockquote>

<blockquote>
  <p><strong>#4</strong> That was a toy example. Would you like to see something for real? Check out <a href="https://github.com/lucasdavid/Demosthenes/blob/master/Demosthenes.Services/EnrollmentService.cs#L51">this statement</a>. It’s validating if a <code class="language-plaintext highlighter-rouge">Student</code> can enroll in a <code class="language-plaintext highlighter-rouge">Class</code>, considering all the <code class="language-plaintext highlighter-rouge">Schedules</code> of that <code class="language-plaintext highlighter-rouge">Class</code> and of all the <code class="language-plaintext highlighter-rouge">Classes</code> that he was already enrolled.</p>
</blockquote>

<h2 id="existing-orms">Existing ORMs</h2>
<p>I must say it’s probably not a good idea to implement your own <code class="language-plaintext highlighter-rouge">ORM</code>. In fact, <strong>reuse</strong> is regarded as a principle in <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">OOP</a>! There are many out there - with many good people working on it - that are highly optimized and will do just fine. Besides, if you don’t like something, there is your chance to write code that will be used by other people and will, most definitely, be appreciated! Anyhow, the list is extensive and will most likely contain an option of your interest. These are the ones I’ve had contact with:</p>

<ul>
  <li><a href="https://www.asp.net/mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application">Entity Framework</a> (C#)</li>
  <li><a href="https://docs.djangoproject.com/en/1.8/topics/db/models/">Django models</a> (Python)</li>
  <li><a href="http://laravel.com/docs/4.2/eloquent">Laravel’s Eloquent</a> (PHP)</li>
  <li><a href="http://docs.sqlalchemy.org/en/rel_1_0/orm/tutorial.html">Sqalchemy</a> (Python)</li>
  <li><a href="http://www.javaworld.com/article/2077817/java-se/understanding-jpa-part-1-the-object-oriented-paradigm-of-data-persistence.html">JPA</a> (Java)</li>
  <li><a href="http://projects.spring.io/spring-data-jpa/">Spring data JPA</a> (Java)</li>
</ul>

<h2 id="cool-additional-features">Cool additional features</h2>
<h3 id="lazy-and-eager-loading">Lazy and eager loading</h3>
<p>Yes, yes, that is where I took the name of the ending section from… This can help you a lot with performance. Or make it much worse. That’s why you should understand it: as in the <code class="language-plaintext highlighter-rouge">Schedule</code>’s example, application’s entities are related. Inheritances, relationships: many times you need that information, but it isn’t in the table that you’re currently looking, which means you <strong>must</strong> perform a <code class="language-plaintext highlighter-rouge">join</code>. Another times, you don’t need that information, so you want to <strong>avoid</strong> the <code class="language-plaintext highlighter-rouge">join</code>.</p>

<h4 id="lazy">Lazy</h4>
<p>Lazy-loading’s policy is “only retrieve if needed”, which means it won’t join tables unless you explicitly try to access it.</p>

<h5 id="a-case-where-lazy-loading-is-recommended">A case where Lazy-loading is recommended:</h5>
<p>Imagine we work for <a href="https://bitbucket.org">Bitbucket.org</a> and we are implementing a page where one can add contributors to their current repository. We only need the usernames, not these users’ repositories, friends, permissions, roles <code class="language-plaintext highlighter-rouge">[, [\w]+]*</code>. Therefore, it would be recommended to lazy load, as many unnecessary joins would be avoided.</p>

<p>Using <a href="https://docs.djangoproject.com/en/1.8/topics/db/models/">Django models</a>:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>
<span class="n">usernames</span> <span class="o">=</span> <span class="p">[</span><span class="n">user</span><span class="p">.</span><span class="n">username</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span>
</code></pre></div></div>
<p>Using <a href="https://www.asp.net/mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application">Entity Framework</a>:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">usernames</span> <span class="p">=</span>  <span class="n">Db</span><span class="p">.</span><span class="n">Users</span>
    <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">u</span> <span class="p">=&gt;</span> <span class="n">u</span><span class="p">.</span><span class="n">Username</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="a-case-where-lazy-loading-is-not-recommended">A case where Lazy-loading is NOT recommended:</h4>
<p>What if we need the users <code class="language-plaintext highlighter-rouge">permissions</code> list as well? The fact is an <code class="language-plaintext highlighter-rouge">user.permissions</code> property is not set, and will need a following database-lookup in order to be ready. Therefore, the following code would produce <code class="language-plaintext highlighter-rouge">1 + n</code> database-lookups, where <code class="language-plaintext highlighter-rouge">n</code> is the number of registered <code class="language-plaintext highlighter-rouge">users</code>. That’s disastrously bad.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>
<span class="n">usernames_and_permissions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">user</span><span class="p">.</span><span class="n">username</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">permissions</span><span class="p">,)</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span>
</code></pre></div></div>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">users</span> <span class="p">=</span> <span class="n">Db</span><span class="p">.</span><span class="n">Users</span>
    <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">u</span> <span class="p">=&gt;</span> <span class="k">new</span>
    <span class="p">{</span>
        <span class="n">Username</span>    <span class="p">=</span> <span class="n">u</span><span class="p">.</span><span class="n">Username</span>
        <span class="n">Permissions</span> <span class="p">=</span> <span class="n">u</span><span class="p">.</span><span class="n">Permissions</span>
    <span class="p">});</span>
</code></pre></div></div>

<h4 id="a-case-where-eager-loading-is-recommended">A case where Eager-loading is recommended:</h4>
<p>The above, of course. How to solve it? Just ask the driver to prefetch the related object.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'permissions'</span><span class="p">).</span><span class="nb">all</span><span class="p">()</span>
<span class="n">usernames_and_permissions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">user</span><span class="p">.</span><span class="n">username</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">permissions</span><span class="p">,)</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span>
</code></pre></div></div>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">users</span> <span class="p">=</span> <span class="n">Db</span><span class="p">.</span><span class="n">Users</span>
    <span class="p">.</span><span class="nf">Include</span><span class="p">(</span><span class="n">u</span> <span class="p">=&gt;</span> <span class="n">u</span><span class="p">.</span><span class="n">Permissions</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">u</span> <span class="p">=&gt;</span> <span class="k">new</span>
    <span class="p">{</span>
        <span class="n">Username</span>    <span class="p">=</span> <span class="n">u</span><span class="p">.</span><span class="n">Username</span><span class="p">,</span>
        <span class="n">Permissions</span> <span class="p">=</span> <span class="n">u</span><span class="p">.</span><span class="n">Permissions</span>
    <span class="p">});</span>
</code></pre></div></div>

<blockquote>
  <p><strong>#5</strong> <code class="language-plaintext highlighter-rouge">.prefetch_related</code> actually selects the whole data and joins it using <code class="language-plaintext highlighter-rouge">Python</code>, whereas <code class="language-plaintext highlighter-rouge">.Include()</code> will be translated to SQL and ask the database management system to do the joining. Just a difference made by the frameworks…</p>
</blockquote>

<h3 id="automatic-migrations">Automatic migrations</h3>
<p>You’ll definitely want to check this out. <code class="language-plaintext highlighter-rouge">Automatic migrations</code> stands for the idea that we could automatically generate the database when we need it, in opposite of designing it from scratch, because there is a 1-to-1 mapping from your model classes to your database tables. Summarizing: write your classes and export it to your database.</p>

<h4 id="examples-of-automatic-migrations">Examples of automatic migrations</h4>
<h5 id="django">Django</h5>
<p>Assume you have classes in <code class="language-plaintext highlighter-rouge">models.py</code> that extend <code class="language-plaintext highlighter-rouge">models.Model</code>, run:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="n">makemigrations</span>
<span class="n">python</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="n">migrate</span>
</code></pre></div></div>
<p>Done!</p>

<h5 id="net-framework">.NET framework</h5>
<p>Assume you have implemented your model classes and that they were added to your <code class="language-plaintext highlighter-rouge">Context</code> class. Hit <code class="language-plaintext highlighter-rouge">Ctrl+Q</code>, search for <code class="language-plaintext highlighter-rouge">Package Manage Console</code>.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Update-Database
</code></pre></div></div>
<p>Done!</p>

<h5 id="laravel">Laravel</h5>
<p>Assume you have a class User that extends <code class="language-plaintext highlighter-rouge">Eloquent</code>.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:migration create_users_table <span class="nt">--create</span><span class="o">=</span><span class="nb">users
</span>php artisan migrate
</code></pre></div></div>
<p>Done!</p>

<p>These are just some examples! You can find these features in any language you want!</p>

<h2 id="short-version-for-lazy-loaders">Short version for lazy-loaders</h2>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Main thought of this post:</span>
<span class="c1">// Don't be a dumbass programmer writing dumbass SQL strings!</span>
<span class="c1">// Instead, do it like this:</span>

<span class="c1">// Ordering...</span>
<span class="kt">var</span> <span class="n">schedules</span> <span class="p">=</span> <span class="n">Db</span><span class="p">.</span><span class="n">Schedules</span>
    <span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">DayOfWeek</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">ThenBy</span><span class="p">(</span><span class="n">TimeStarted</span><span class="p">);</span>

<span class="c1">// Joining...</span>
<span class="kt">var</span> <span class="n">classes</span> <span class="p">=</span> <span class="n">Db</span><span class="p">.</span><span class="n">Classes</span>
    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Schedules</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span>
        <span class="n">s</span><span class="p">.</span><span class="n">DayOfWeek</span> <span class="p">==</span> <span class="n">DayOfWeek</span><span class="p">.</span><span class="n">Monday</span>
        <span class="p">&amp;&amp;</span> <span class="n">s</span><span class="p">.</span><span class="n">TimeStarted</span> <span class="p">&gt;=</span> <span class="k">new</span> <span class="nf">TimeSpan</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)));</span>

<span class="c1">// Selecting...</span>
<span class="kt">var</span> <span class="n">users</span> <span class="p">=</span> <span class="n">Db</span><span class="p">.</span><span class="n">Users</span>
    <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">u</span> <span class="p">=&gt;</span> <span class="n">u</span><span class="p">.</span><span class="n">Username</span><span class="p">);</span>
</code></pre></div></div>

        </div>
      </article>

      
      <div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://lucasdavid-github-io.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
    </div>
  </div>
</div>
<div class="empty-v-space d-none d-xl-block" style="margin-bottom: 10vh"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"
  integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"
  integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js"
  integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
  onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true},{left: '\\[', right: '\\]', display: true}, {left: '$', right: '$', display: false},{left: '\\(', right: '\\)', display: false}]});"></script>

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
<script>
  anchors.options = { icon: '#' };
  anchors.add();
</script>


  <!-- <svg id="visual" viewBox="0 0 1980 300"  class="curve-container__curve curve-three" xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
  <path
    d="M0 69L55 90.2C110 111.3 220 153.7 330 169.8C440 186 550 176 660 165.5C770 155 880 144 990 139.2C1100 134.3 1210 135.7 1320 137.7C1430 139.7 1540 142.3 1650 155.5C1760 168.7 1870 192.3 1925 204.2L1980 216L1980 301L1925 301C1870 301 1760 301 1650 301C1540 301 1430 301 1320 301C1210 301 1100 301 990 301C880 301 770 301 660 301C550 301 440 301 330 301C220 301 110 301 55 301L0 301Z"
    fill="#d3d3d3"></path>
  <path
    d="M0 89L55 107.8C110 126.7 220 164.3 330 191.3C440 218.3 550 234.7 660 243.8C770 253 880 255 990 252.3C1100 249.7 1210 242.3 1320 228.8C1430 215.3 1540 195.7 1650 174.5C1760 153.3 1870 130.7 1925 119.3L1980 108L1980 301L1925 301C1870 301 1760 301 1650 301C1540 301 1430 301 1320 301C1210 301 1100 301 990 301C880 301 770 301 660 301C550 301 440 301 330 301C220 301 110 301 55 301L0 301Z"
    fill="#6a6a6a"></path>
  <path
    d="M0 229L55 232.3C110 235.7 220 242.3 330 244.3C440 246.3 550 243.7 660 247.3C770 251 880 261 990 254.8C1100 248.7 1210 226.3 1320 223.5C1430 220.7 1540 237.3 1650 233.8C1760 230.3 1870 206.7 1925 194.8L1980 183L1980 301L1925 301C1870 301 1760 301 1650 301C1540 301 1430 301 1320 301C1210 301 1100 301 990 301C880 301 770 301 660 301C550 301 440 301 330 301C220 301 110 301 55 301L0 301Z"
    fill="#121212"></path>
</svg> -->
<footer class="page-footer text-bg-dark bg-black-subtle d-print-none">
  <div class="container">
    <div class="mt-4 mb-5">
      
        <div class="row g-1 mb-4">
          
          <div class="col">
            <div class="card bg-black-subtle border-0 border-start border-dark rounded-0">
              <div class="card-body font-small pt-0 pb-0">
                <h6 class="card-title fw-bold text-light">Keras Explainable</h6>
                <p class="card-text text-light">
                  Clean implementations for AI explaining methods in Keras.
<a href="https://github.com/lucasdavid/keras-explainable" target="_new">Code</a> and
<a href="https://lucasdavid.github.io/keras-explainable" target="_new">docs</a> are available.
                </p>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="card bg-black-subtle border-0 border-start border-dark rounded-0">
              <div class="card-body font-small pt-0 pb-0">
                <h6 class="card-title fw-bold text-light">Supporting Study Material</h6>
                <p class="card-text text-light">
                  If you are an undergrad student and are looking for additional study material,
check out our collaborative project <a href="http://comp-ufscar.github.io/">comp-ufscar.github.io</a>.
                </p>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="card bg-black-subtle border-0 border-start border-dark rounded-0">
              <div class="card-body font-small pt-0 pb-0">
                <h6 class="card-title fw-bold text-light">Algorithms in TensorFlow</h6>
                <p class="card-text text-light">
                  I'm implementing all algorithms I find interesting using TensorFlow.
You can check it out at <a href="https://github.com/lucasdavid/algorithms-in-tensorflow/">github.com/lucasdavid/algorithms-in-tensorflow</a>.
                </p>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="card bg-black-subtle border-0 border-start border-dark rounded-0">
              <div class="card-body font-small pt-0 pb-0">
                <h6 class="card-title fw-bold text-light">TF-Experiment</h6>
                <p class="card-text text-light">
                  And environment to run Machine Learning experiments based on components and mixins. Available at <a href="https://github.com/lucasdavid/tf-experiment">github.com/lucasdavid/tf-experiment</a>.
                </p>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="card bg-black-subtle border-0 border-start border-dark rounded-0">
              <div class="card-body font-small pt-0 pb-0">
                <h6 class="card-title fw-bold text-light">Mineração de Dados Complexos</h6>
                <p class="card-text text-light">
                  Information around the extension program "Mineração de Dados Complexos (in Portuguese)" is available at
<a href="https://www.ic.unicamp.br/~mdc/" target="_blank">ic.unicamp.br/~mdc/</a>.
                </p>
              </div>
            </div>
          </div>
          
        </div>
        
    </div>

    <div class="text-end mt-4">
      


<div class="fs-2">
  
    <a href="https://github.com/lucasdavid"
      target="_blank"
      ><i
      aria-label="GitHub"
      class="bi bi-github link-light"></i></a>
  
  
    <a href="https://www.linkedin.com/in/ld7"
      target="_blank"
      title="LinkedIn"><i class="bi bi-linkedin text-primary sr-none"></i></a>
  
  <span itemscope itemtype="https://schema.org/Person">
    <a itemprop="sameAs" content="https://orcid.org/0000-0002-8793-7300" href="https://orcid.org/0000-0002-8793-7300"
       target="orcid.widget"
       rel="me noopener noreferrer"
       title="ORCID"
      ><img src="/assets/images/infra/32px-ORCID_iD.webp" alt="ORCID logo" class="sr-none" style="margin-bottom: 7px; width: 32px;"></a>
  </span>
  
  <a href="http://stackoverflow.com/users/2429640/lucasdavid"
     target="_blank"
     title="Stackoverflow"><i class="bi bi-code-slash link-light sr-none"></i></a>
  
    <a href="https://youtube.com/channel/UC7IWeKUy4OSlC5ripcQGD6Q"
      target="_blank"
      title="Youtube"><i class="bi bi-youtube text-danger sr-none"></i></a>
  
    <a href="mailto:mb37410l3@mozmail.com"
      target="_blank"
      title="Mail"><i class="bi bi-envelope-fill link-light sr-none"></i></a>
  
  <a href="assets/docs/lucas-david-resume.pdf"
     target="_blank"
     title="Resume"><i class="bi bi-person-lines-fill link-light sr-none"></i></a>
</div>

    </div>
    <div class="text-end">
      <p>
        ® Lucas David. Todos os direitos reservados.
      </p>
    </div>
</div>
</footer>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous" defer></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous" defer></script>

</body>
</html>
